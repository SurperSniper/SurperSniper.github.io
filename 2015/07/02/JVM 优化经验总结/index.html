
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>JVM 优化经验总结 | Zzzz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="lmg">
    

    
    <meta name="description" content="本文讲解了如何将新对象预留在年轻代、如何让大对象进入年老代、如何设置对象进入年老代的年龄、稳定的 Java 堆 VS 动荡的 Java 堆、增大吞吐量提升系统性能、尝试使用大的内存分页、使用非占有的垃圾回收器等主题。
Java 虚拟机有自己完善的硬件架构, 如处理器、堆栈、寄存器等，还具有相应的指令系统。JVM 屏蔽了与具体操作系统平台相关的信息，使得 Java 程序只需生成在 Java 虚拟机上">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM 优化经验总结">
<meta property="og:url" content="http://yoursite.com/2015/07/02/JVM 优化经验总结/index.html">
<meta property="og:site_name" content="Zzzz">
<meta property="og:description" content="本文讲解了如何将新对象预留在年轻代、如何让大对象进入年老代、如何设置对象进入年老代的年龄、稳定的 Java 堆 VS 动荡的 Java 堆、增大吞吐量提升系统性能、尝试使用大的内存分页、使用非占有的垃圾回收器等主题。
Java 虚拟机有自己完善的硬件架构, 如处理器、堆栈、寄存器等，还具有相应的指令系统。JVM 屏蔽了与具体操作系统平台相关的信息，使得 Java 程序只需生成在 Java 虚拟机上">
<meta property="og:updated_time" content="2015-07-01T07:41:20.266Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JVM 优化经验总结">
<meta name="twitter:description" content="本文讲解了如何将新对象预留在年轻代、如何让大对象进入年老代、如何设置对象进入年老代的年龄、稳定的 Java 堆 VS 动荡的 Java 堆、增大吞吐量提升系统性能、尝试使用大的内存分页、使用非占有的垃圾回收器等主题。
Java 虚拟机有自己完善的硬件架构, 如处理器、堆栈、寄存器等，还具有相应的指令系统。JVM 屏蔽了与具体操作系统平台相关的信息，使得 Java 程序只需生成在 Java 虚拟机上">

    
    <link rel="alternative" href="/atom.xml" title="Zzzz" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Zzzz" title="Zzzz"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Zzzz">Zzzz</a></h1>
				<h2 class="blog-motto">Do your best under limited conditions</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/02/JVM 优化经验总结/" title="JVM 优化经验总结" itemprop="url">JVM 优化经验总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lmg" target="_blank" itemprop="author">lmg</a>
		
  <p class="article-time">
    <time datetime="2015-07-02T08:23:27.000Z" itemprop="datePublished"> 发表于 2015-07-02</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何将新对象预留在年轻代"><span class="toc-number">1.</span> <span class="toc-text">如何将新对象预留在年轻代</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_1-_相同大小内存分配"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">清单 1. 相同大小内存分配</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_2-_清单_1_运行输出"><span class="toc-number">1.0.0.2.</span> <span class="toc-text">清单 2. 清单 1 运行输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_3-"><span class="toc-number">1.0.0.3.</span> <span class="toc-text">清单 3.</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_4-_不同大小内存分配"><span class="toc-number">1.0.0.4.</span> <span class="toc-text">清单 4. 不同大小内存分配</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_5-_清单_4_运行输出"><span class="toc-number">1.0.0.5.</span> <span class="toc-text">清单 5. 清单 4 运行输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_6-_修改运行参数后清单_4_输出"><span class="toc-number">1.0.0.6.</span> <span class="toc-text">清单 6. 修改运行参数后清单 4 输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_7-_再次修改运行参数后清单_4_输出"><span class="toc-number">1.0.0.7.</span> <span class="toc-text">清单 7. 再次修改运行参数后清单 4 输出</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何让大对象进入年老代"><span class="toc-number">2.</span> <span class="toc-text">如何让大对象进入年老代</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_8-_创建一个大对象"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">清单 8. 创建一个大对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_9-_清单_8_运行输出"><span class="toc-number">2.0.0.2.</span> <span class="toc-text">清单 9. 清单 8 运行输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_10-_修改运行参数后清单_8_输出"><span class="toc-number">2.0.0.3.</span> <span class="toc-text">清单 10. 修改运行参数后清单 8 输出</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何设置对象进入年老代的年龄"><span class="toc-number">3.</span> <span class="toc-text">如何设置对象进入年老代的年龄</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_11-_申请内存"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">清单 11. 申请内存</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_12-_清单_11_运行输出"><span class="toc-number">3.0.0.2.</span> <span class="toc-text">清单 12. 清单 11 运行输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_13-_修改运行参数后清单_11_输出"><span class="toc-number">3.0.0.3.</span> <span class="toc-text">清单 13. 修改运行参数后清单 11 输出</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#稳定的_Java_堆_VS_动荡的_Java_堆"><span class="toc-number">4.</span> <span class="toc-text">稳定的 Java 堆 VS 动荡的 Java 堆</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_14-_堆大小设置"><span class="toc-number">4.0.0.1.</span> <span class="toc-text">清单 14. 堆大小设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_15-_修改运行参数后清单_14_输出"><span class="toc-number">4.0.0.2.</span> <span class="toc-text">清单 15. 修改运行参数后清单 14 输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#清单_16-"><span class="toc-number">4.0.0.3.</span> <span class="toc-text">清单 16.</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#增大吞吐量提升系统性能"><span class="toc-number">5.</span> <span class="toc-text">增大吞吐量提升系统性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#尝试使用大的内存分页"><span class="toc-number">6.</span> <span class="toc-text">尝试使用大的内存分页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用非占有的垃圾回收器"><span class="toc-number">7.</span> <span class="toc-text">使用非占有的垃圾回收器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结束语"><span class="toc-number">8.</span> <span class="toc-text">结束语</span></a></li></ol>
		
		</div>
		
		<p>本文讲解了如何将新对象预留在年轻代、如何让大对象进入年老代、如何设置对象进入年老代的年龄、稳定的 Java 堆 VS 动荡的 Java 堆、增大吞吐量提升系统性能、尝试使用大的内存分页、使用非占有的垃圾回收器等主题。</p>
<p>Java 虚拟机有自己完善的硬件架构, 如处理器、堆栈、寄存器等，还具有相应的指令系统。JVM 屏蔽了与具体操作系统平台相关的信息，使得 Java 程序只需生成在 Java 虚拟机上运行的目标代码 (字节码), 就可以在多种平台上不加修改地运行。Java 虚拟机在执行字节码时，实际上最终还是把字节码解释成具体平台上的机器指令执行。</p>
<p>注意：本文仅针对 JDK7、HotSPOT Java 虚拟机，对于 JDK8 引入的 JVM 新特性及其他 Java 虚拟机，本文不予关注。</p>
<p>我们以一个例子开始这篇文章。假设你是一个普通的 Java 对象，你出生在 Eden 区，在 Eden 区有许多和你差不多的小兄弟、小姐妹，可以把 Eden 区当成幼儿园，在这个幼儿园里大家玩了很长时间。Eden 区不能无休止地放你们在里面，所以当年纪稍大，你就要被送到学校去上学，这里假设从小学到高中都称为 Survivor 区。开始的时候你在 Survivor 区里面划分出来的的“From”区，读到高年级了，就进了 Survivor 区的“To”区，中间由于学习成绩不稳定，还经常来回折腾。直到你 18 岁的时候，高中毕业了，该去社会上闯闯了。于是你就去了年老代，年老代里面人也很多。在年老代里，你生活了 20 年 (每次 GC 加一岁)，最后寿终正寝，被 GC 回收。有一点没有提，你在年老代遇到了一个同学，他的名字叫爱德华 (慕光之城里的帅哥吸血鬼)，他以及他的家族永远不会死，那么他们就生活在永生代。</p>
<hr>
<h2 id="如何将新对象预留在年轻代">如何将新对象预留在年轻代</h2><p>众所周知，由于 Full GC 的成本远远高于 Minor<br> GC，因此某些情况下需要尽可能将对象分配在年轻代，这在很多情况下是一个明智的选择。虽然在大部分情况下，JVM 会尝试在 Eden 区分配对象，但是由于空间紧张等问题，很可能不得不将部分年轻对象提前向年老代压缩。因此，在 JVM 参数调优时可以为应用程序分配一个合理的年轻代空间，以最大限度避免新对象直接进入年老代的情况发生。清单 1 所示代码尝试分配 4MB 内存空间，观察一下它的内存使用情况。</p>
<h5 id="清单_1-_相同大小内存分配">清单 1. 相同大小内存分配</h5><pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PutInEden</span> {
 <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>)</span>{
 <span class="keyword">byte</span>[] b1,b2,b3,b4;<span class="comment">//定义变量</span>
 b1=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];<span class="comment">//分配 1MB 堆空间，考察堆空间的使用情况</span>
 b2=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];
 b3=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];
 b4=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];
 }
}
</code></pre><p>使用 JVM 参数-XX:+PrintGCDetails -Xmx20M -Xms20M 运行清单 1 所示代码，输出如清单 2 所示。</p>
<h5 id="清单_2-_清单_1_运行输出">清单 2. 清单 1 运行输出</h5><pre><code>[GC [DefNew: <span class="number">5504</span><span class="keyword">K</span>-&gt;<span class="number">640</span><span class="keyword">K</span>(<span class="number">6144</span><span class="keyword">K</span>), <span class="number">0.0114236</span> secs] <span class="number">5504</span><span class="keyword">K</span>-&gt;<span class="number">5352</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>), 
   <span class="number">0.0114595</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] 
[GC [DefNew: <span class="number">6144</span><span class="keyword">K</span>-&gt;<span class="number">640</span><span class="keyword">K</span>(<span class="number">6144</span><span class="keyword">K</span>), <span class="number">0.0131261</span> secs] <span class="number">10856</span><span class="keyword">K</span>-&gt;<span class="number">10782</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>),
<span class="number">0.0131612</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] 
[GC [DefNew: <span class="number">6144</span><span class="keyword">K</span>-&gt;<span class="number">6144</span><span class="keyword">K</span>(<span class="number">6144</span><span class="keyword">K</span>), <span class="number">0.0000170</span> secs][Tenured: <span class="number">10142</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>),
<span class="number">0.1069249</span> secs] <span class="number">16286</span><span class="keyword">K</span>-&gt;<span class="number">15966</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>), [Perm : <span class="number">376</span><span class="keyword">K</span>-&gt;<span class="number">376</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)],
<span class="number">0.1070058</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.11</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0302067</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19595</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>), 
[Perm : <span class="number">376</span><span class="keyword">K</span>-&gt;<span class="number">376</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0302635</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0311986</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19839</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>), 
[Perm : <span class="number">376</span><span class="keyword">K</span>-&gt;<span class="number">376</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0312515</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0358821</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19825</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>), 
[Perm : <span class="number">376</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0359315</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.05</span> sys=<span class="number">0.00</span>, real=<span class="number">0.05</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0283080</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19839</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0283723</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0284469</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19839</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0284990</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0283005</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19839</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0283475</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0287757</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19839</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0288294</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0288219</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19839</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>), 
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0288709</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0293071</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19839</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0293607</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">13695</span><span class="keyword">K</span>-&gt;<span class="number">13695</span><span class="keyword">K</span>(<span class="number">13696</span><span class="keyword">K</span>), <span class="number">0.0356141</span> secs] <span class="number">19839</span><span class="keyword">K</span>-&gt;<span class="number">19838</span><span class="keyword">K</span>(<span class="number">19840</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0356654</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
Heap
 def new generation total <span class="number">6144</span><span class="keyword">K</span>, used <span class="number">6143</span><span class="keyword">K</span> [<span class="number">0x35c10000</span>, <span class="number">0x362b0000</span>, <span class="number">0x362b0000</span>)
 eden space <span class="number">5504</span><span class="keyword">K</span>, <span class="number">100</span>% used [<span class="number">0x35c10000</span>, <span class="number">0x36170000</span>, <span class="number">0x36170000</span>)
 from space <span class="number">640</span><span class="keyword">K</span>, <span class="number">99</span>% used [<span class="number">0x36170000</span>, <span class="number">0x3620fc80</span>, <span class="number">0x36210000</span>)
 to space <span class="number">640</span><span class="keyword">K</span>, <span class="number">0</span>% used [<span class="number">0x36210000</span>, <span class="number">0x36210000</span>, <span class="number">0x362b0000</span>)
 tenured generation total <span class="number">13696</span><span class="keyword">K</span>, used <span class="number">13695</span><span class="keyword">K</span> [<span class="number">0x362b0000</span>, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 the space <span class="number">13696</span><span class="keyword">K</span>, <span class="number">99</span>% used [<span class="number">0x362b0000</span>, <span class="number">0x3700fff8</span>, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 compacting perm gen total <span class="number">12288</span><span class="keyword">K</span>, used <span class="number">371</span><span class="keyword">K</span> [<span class="number">0x37010000</span>, <span class="number">0x37c10000</span>, <span class="number">0x3b010000</span>)
 the space <span class="number">12288</span><span class="keyword">K</span>, <span class="number">3</span>% used [<span class="number">0x37010000</span>, <span class="number">0x3706cd20</span>, <span class="number">0x3706ce00</span>, <span class="number">0x37c10000</span>)
 ro space <span class="number">10240</span><span class="keyword">K</span>, <span class="number">51</span>% used [<span class="number">0x3b010000</span>, <span class="number">0x3b543000</span>, <span class="number">0x3b543000</span>, <span class="number">0x3ba10000</span>)
 rw space <span class="number">12288</span><span class="keyword">K</span>, <span class="number">55</span>% used [<span class="number">0x3ba10000</span>, <span class="number">0x3c0ae4f8</span>, <span class="number">0x3c0ae600</span>, <span class="number">0x3c610000</span>)
</code></pre><p>清单 2 所示的日志输出显示年轻代 Eden 的大小有 5MB 左右。分配足够大的年轻代空间，使用 JVM 参数-XX:+PrintGCDetails -Xmx20M<br> -Xms20M-Xmn6M 运行清单 1 所示代码，输出如清单 3 所示。</p>
<h5 id="清单_3-">清单 3.</h5><p> 增大 Eden 大小后清单 1 运行输出</p>
<pre><code>[GC [DefNew: <span class="number">4992</span><span class="keyword">K</span>-&gt;<span class="number">576</span><span class="keyword">K</span>(<span class="number">5568</span><span class="keyword">K</span>), <span class="number">0.0116036</span> secs] <span class="number">4992</span><span class="keyword">K</span>-&gt;<span class="number">4829</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>), 
 <span class="number">0.0116439</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] 
[GC [DefNew: <span class="number">5568</span><span class="keyword">K</span>-&gt;<span class="number">576</span><span class="keyword">K</span>(<span class="number">5568</span><span class="keyword">K</span>), <span class="number">0.0130929</span> secs] <span class="number">9821</span><span class="keyword">K</span>-&gt;<span class="number">9653</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>), 
<span class="number">0.0131336</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] 
[GC [DefNew: <span class="number">5568</span><span class="keyword">K</span>-&gt;<span class="number">575</span><span class="keyword">K</span>(<span class="number">5568</span><span class="keyword">K</span>), <span class="number">0.0154148</span> secs] <span class="number">14645</span><span class="keyword">K</span>-&gt;<span class="number">14500</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>),
<span class="number">0.0154531</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.00</span> sys=<span class="number">0.01</span>, real=<span class="number">0.01</span> secs] 
[GC [DefNew: <span class="number">5567</span><span class="keyword">K</span>-&gt;<span class="number">5567</span><span class="keyword">K</span>(<span class="number">5568</span><span class="keyword">K</span>), <span class="number">0.0000197</span> secs][Tenured: <span class="number">13924</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>),
<span class="number">0.0330724</span> secs] <span class="number">19492</span><span class="keyword">K</span>-&gt;<span class="number">19265</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>), [Perm : <span class="number">376</span><span class="keyword">K</span>-&gt;<span class="number">376</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)],
<span class="number">0.0331624</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">14335</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>), <span class="number">0.0292459</span> secs] <span class="number">19903</span><span class="keyword">K</span>-&gt;<span class="number">19902</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>),
[Perm : <span class="number">376</span><span class="keyword">K</span>-&gt;<span class="number">376</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0293000</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">14335</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>), <span class="number">0.0278675</span> secs] <span class="number">19903</span><span class="keyword">K</span>-&gt;<span class="number">19903</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>),
[Perm : <span class="number">376</span><span class="keyword">K</span>-&gt;<span class="number">376</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0279215</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">14335</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>), <span class="number">0.0348408</span> secs] <span class="number">19903</span><span class="keyword">K</span>-&gt;<span class="number">19889</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>),
[Perm : <span class="number">376</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0348945</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.05</span> sys=<span class="number">0.00</span>, real=<span class="number">0.05</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">14335</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>), <span class="number">0.0299813</span> secs] <span class="number">19903</span><span class="keyword">K</span>-&gt;<span class="number">19903</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0300349</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] 
[<span class="keyword">Full</span> GC [Tenured: <span class="number">14335</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>), <span class="number">0.0298178</span> secs] <span class="number">19903</span><span class="keyword">K</span>-&gt;<span class="number">19903</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0298688</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: Java heap space[<span class="keyword">Full</span> GC [Tenured: 
<span class="number">14335</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>), <span class="number">0.0294953</span> secs] <span class="number">19903</span><span class="keyword">K</span>-&gt;<span class="number">19903</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0295474</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenured
: <span class="number">14335</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>), <span class="number">0.0287742</span> secs] <span class="number">19903</span><span class="keyword">K</span>-&gt;<span class="number">19903</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>), 
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0288239</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[<span class="keyword">Full</span> GC [Tenuredat GCTimeTest.main(GCTimeTest.java:<span class="number">16</span>)
: <span class="number">14335</span><span class="keyword">K</span>-&gt;<span class="number">14335</span><span class="keyword">K</span>(<span class="number">14336</span><span class="keyword">K</span>), <span class="number">0.0287102</span> secs] <span class="number">19903</span><span class="keyword">K</span>-&gt;<span class="number">19903</span><span class="keyword">K</span>(<span class="number">19904</span><span class="keyword">K</span>),
[Perm : <span class="number">371</span><span class="keyword">K</span>-&gt;<span class="number">371</span><span class="keyword">K</span>(<span class="number">12288</span><span class="keyword">K</span>)], <span class="number">0.0287627</span> secs] [<span class="keyword">Times</span>: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
Heap
 def new generation total <span class="number">5568</span><span class="keyword">K</span>, used <span class="number">5567</span><span class="keyword">K</span> [<span class="number">0x35c10000</span>, <span class="number">0x36210000</span>, <span class="number">0x36210000</span>)
 eden space <span class="number">4992</span><span class="keyword">K</span>, <span class="number">100</span>% used [<span class="number">0x35c10000</span>, <span class="number">0x360f0000</span>, <span class="number">0x360f0000</span>)
 from space <span class="number">576</span><span class="keyword">K</span>, <span class="number">99</span>% used [<span class="number">0x36180000</span>, <span class="number">0x3620ffe8</span>, <span class="number">0x36210000</span>)
 to space <span class="number">576</span><span class="keyword">K</span>, <span class="number">0</span>% used [<span class="number">0x360f0000</span>, <span class="number">0x360f0000</span>, <span class="number">0x36180000</span>)
 tenured generation total <span class="number">14336</span><span class="keyword">K</span>, used <span class="number">14335</span><span class="keyword">K</span> [<span class="number">0x36210000</span>, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 the space <span class="number">14336</span><span class="keyword">K</span>, <span class="number">99</span>% used [<span class="number">0x36210000</span>, <span class="number">0x3700ffd8</span>, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 compacting perm gen total <span class="number">12288</span><span class="keyword">K</span>, used <span class="number">371</span><span class="keyword">K</span> [<span class="number">0x37010000</span>, <span class="number">0x37c10000</span>, <span class="number">0x3b010000</span>)
 the space <span class="number">12288</span><span class="keyword">K</span>, <span class="number">3</span>% used [<span class="number">0x37010000</span>, <span class="number">0x3706ce28</span>, <span class="number">0x3706d000</span>, <span class="number">0x37c10000</span>)
 ro space <span class="number">10240</span><span class="keyword">K</span>, <span class="number">51</span>% used [<span class="number">0x3b010000</span>, <span class="number">0x3b543000</span>, <span class="number">0x3b543000</span>, <span class="number">0x3ba10000</span>)
 rw space <span class="number">12288</span><span class="keyword">K</span>, <span class="number">55</span>% used [<span class="number">0x3ba10000</span>, <span class="number">0x3c0ae4f8</span>, <span class="number">0x3c0ae600</span>, <span class="number">0x3c610000</span>)
</code></pre><p>通过清单 2 和清单 3 对比，可以发现通过设置一个较大的年轻代预留新对象，设置合理的 Survivor 区并且提供 Survivor 区的使用率，可以将年轻对象保存在年轻代。一般来说，Survivor 区的空间不够，或者占用量达到 50%时，就会使对象进入年老代 (不管它的年龄有多大)。清单 4 创建了 3 个对象，分别分配一定的内存空间。</p>
<h5 id="清单_4-_不同大小内存分配">清单 4. 不同大小内存分配</h5><pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PutInEden2</span> {
 <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>)</span>{
 <span class="keyword">byte</span>[] b1,b2,b3;
 b1=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">512</span>];<span class="comment">//分配 0.5MB 堆空间</span>
 b2=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">4</span>];<span class="comment">//分配 4MB 堆空间</span>
 b3=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">4</span>];
 b3=<span class="keyword">null</span>; <span class="comment">//使 b3 可以被回收</span>
 b3=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">4</span>];<span class="comment">//分配 4MB 堆空间</span>
 }
}
</code></pre><p>使用参数-XX:+PrintGCDetails -Xmx1000M -Xms500M -Xmn100M<br> -XX:SurvivorRatio=8 运行清单 4 所示代码，输出如清单 5 所示。</p>
<h5 id="清单_5-_清单_4_运行输出">清单 5. 清单 4 运行输出</h5><pre><code>Heap
 def new generation total 92160K, used 11878K [<span class="number">0x0f01000</span>0, <span class="number">0x15410000</span>, <span class="number">0x15410000</span>)
 eden space 81920K, 2% used [<span class="number">0x0f01000</span>0, <span class="number">0x0f1a9</span>a20, <span class="number">0x14010000</span>)
 from space 10240K, 99% used [<span class="number">0x14a10000</span>, 0x1540fff8, <span class="number">0x15410000</span>)
 to space 10240K, 0% used [<span class="number">0x14010000</span>, <span class="number">0x14010000</span>, <span class="number">0x14a10000</span>)
 tenured generation total 409600K, used 86434K [<span class="number">0x15410000</span>, <span class="number">0x2e41000</span>0, <span class="number">0x4d81000</span>0)
 the space 409600K, 21% used [<span class="number">0x15410000</span>, <span class="number">0x1a878</span>b18, <span class="number">0x1a878</span>c00, <span class="number">0x2e41000</span>0)
 compacting perm gen total 12288K, used 2062K [<span class="number">0x4d81000</span>0, <span class="number">0x4e41000</span>0, <span class="number">0x51810000</span>)
 the space 12288K, 16% used [<span class="number">0x4d81000</span>0, 0x4da13b18, 0x4da13c00, <span class="number">0x4e41000</span>0)
No shared spaces configured.
</code></pre><p>清单 5 输出的日志显示，年轻代分配了 8M，年老代也分配了 8M。我们可以尝试加上-XX:TargetSurvivorRatio=90 参数，这样可以提高 from 区的利用率，使 from 区使用到 90%时，再将对象送入年老代，运行清单 4 代码，输出如清单 6 所示。</p>
<h5 id="清单_6-_修改运行参数后清单_4_输出">清单 6. 修改运行参数后清单 4 输出</h5><pre><code>Heap
 def new generation total 9216K, used 9215K [<span class="number">0x35c10000</span>, <span class="number">0x36610000</span>, <span class="number">0x36610000</span>)
 eden space 8192K, 100% used [<span class="number">0x35c10000</span>, <span class="number">0x36410000</span>, <span class="number">0x36410000</span>)
 from space 1024K, 99% used [<span class="number">0x36510000</span>, 0x3660fc50, <span class="number">0x36610000</span>)
 to space 1024K, 0% used [<span class="number">0x36410000</span>, <span class="number">0x36410000</span>, <span class="number">0x36510000</span>)
 tenured generation total 10240K, used 10239K [<span class="number">0x36610000</span>, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 the space 10240K, 99% used [<span class="number">0x36610000</span>, 0x3700ff70, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 compacting perm gen total 12288K, used 371K [<span class="number">0x37010000</span>, <span class="number">0x37c10000</span>, <span class="number">0x3b01000</span>0)
 the space 12288K, 3% used [<span class="number">0x37010000</span>, 0x3706cd90, 0x3706ce00, <span class="number">0x37c10000</span>)
 ro space 10240K, 51% used [<span class="number">0x3b01000</span>0, <span class="number">0x3b54300</span>0, <span class="number">0x3b54300</span>0, 0x3ba10000)
 rw space 12288K, 55% used [0x3ba10000, 0x3c0ae4f8, 0x3c0ae600, <span class="number">0x3c61000</span>0)
</code></pre><p>如果将 SurvivorRatio 设置为 2，将 b1 对象预存在年轻代。输出如清单 7 所示。</p>
<h5 id="清单_7-_再次修改运行参数后清单_4_输出">清单 7. 再次修改运行参数后清单 4 输出</h5><pre><code>Heap
 def new generation total 7680K, used 7679K [<span class="number">0x35c10000</span>, <span class="number">0x36610000</span>, <span class="number">0x36610000</span>)
 eden space 5120K, 100% used [<span class="number">0x35c10000</span>, <span class="number">0x36110000</span>, <span class="number">0x36110000</span>)
 from space 2560K, 99% used [<span class="number">0x36110000</span>, 0x3638fff0, <span class="number">0x36390000</span>)
 to space 2560K, 0% used [<span class="number">0x36390000</span>, <span class="number">0x36390000</span>, <span class="number">0x36610000</span>)
 tenured generation total 10240K, used 10239K [<span class="number">0x36610000</span>, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 the space 10240K, 99% used [<span class="number">0x36610000</span>, 0x3700fff0, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 compacting perm gen total 12288K, used 371K [<span class="number">0x37010000</span>, <span class="number">0x37c10000</span>, <span class="number">0x3b01000</span>0)
 the space 12288K, 3% used [<span class="number">0x37010000</span>, 0x3706ce28, <span class="number">0x3706d00</span>0, <span class="number">0x37c10000</span>)
 ro space 10240K, 51% used [<span class="number">0x3b01000</span>0, <span class="number">0x3b54300</span>0, <span class="number">0x3b54300</span>0, 0x3ba10000)
rw space 12288K, 55% used [0x3ba10000, 0x3c0ae4f8, 0x3c0ae600, <span class="number">0x3c61000</span>0)
</code></pre><hr>
<h2 id="如何让大对象进入年老代">如何让大对象进入年老代</h2><p>我们在大部分情况下都会选择将对象分配在年轻代。但是，对于占用内存较多的大对象而言，它的选择可能就不是这样的。因为大对象出现在年轻代很可能扰乱年轻代 GC，并破坏年轻代原有的对象结构。因为尝试在年轻代分配大对象，很可能导致空间不足，为了有足够的空间容纳大对象，JVM 不得不将年轻代中的年轻对象挪到年老代。因为大对象占用空间多，所以可能需要移动大量小的年轻对象进入年老代，这对 GC 相当不利。基于以上原因，可以将大对象直接分配到年老代，保持年轻代对象结构的完整性，这样可以提高 GC 的效率。如果一个大对象同时又是一个短命的对象，假设这种情况出现很频繁，那对于 GC 来说会是一场灾难。原本应该用于存放永久对象的年老代，被短命的对象塞满，这也意味着对堆空间进行了洗牌，扰乱了分代内存回收的基本思路。因此，在软件开发过程中，应该尽可能避免使用短命的大对象。可以使用参数-XX:PetenureSizeThreshold 设置大对象直接进入年老代的阈值。当对象的大小超过这个值时，将直接在年老代分配。参数-XX:PetenureSizeThreshold 只对串行收集器和年轻代并行收集器有效，并行回收收集器不识别这个参数。</p>
<h5 id="清单_8-_创建一个大对象">清单 8. 创建一个大对象</h5><pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BigObj2Old</span> {
 <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>)</span>{
 <span class="keyword">byte</span>[] b;
 b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];<span class="comment">//分配一个 1MB 的对象</span>
 }
}
</code></pre><p>使用 JVM 参数-XX:+PrintGCDetails –Xmx20M –Xms20MB 运行，可以得到清单 9 所示日志输出。</p>
<h5 id="清单_9-_清单_8_运行输出">清单 9. 清单 8 运行输出</h5><pre><code>Heap
 def new generation total 6144K, used 1378K [<span class="number">0x35c10000</span>, <span class="number">0x362b00</span>00, <span class="number">0x362b00</span>00)
 eden space 5504K, 25% used [<span class="number">0x35c10000</span>, <span class="number">0x35d689</span>e8, <span class="number">0x36170000</span>)
 from space 640K, 0% used [<span class="number">0x36170000</span>, <span class="number">0x36170000</span>, <span class="number">0x36210000</span>)
 to space 640K, 0% used [<span class="number">0x36210000</span>, <span class="number">0x36210000</span>, <span class="number">0x362b00</span>00)
 tenured generation total 13696K, used 0K [<span class="number">0x362b00</span>00, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 the space 13696K, 0% used [<span class="number">0x362b00</span>00, <span class="number">0x362b00</span>00, <span class="number">0x362b02</span>00, <span class="number">0x37010000</span>)
 compacting perm gen total 12288K, used 374K [<span class="number">0x37010000</span>, <span class="number">0x37c10000</span>, <span class="number">0x3b01000</span>0)
 the space 12288K, 3% used [<span class="number">0x37010000</span>, 0x3706dac8, 0x3706dc00, <span class="number">0x37c10000</span>)
 ro space 10240K, 51% used [<span class="number">0x3b01000</span>0, <span class="number">0x3b54300</span>0, <span class="number">0x3b54300</span>0, 0x3ba10000)
 rw space 12288K, 55% used [0x3ba10000, 0x3c0ae4f8, 0x3c0ae600, <span class="number">0x3c61000</span>0)
</code></pre><p>可以看到该对象被分配在了年轻代，占用了 25%的空间。如果需要将 1MB 以上的对象直接在年老代分配，设置-XX:PetenureSizeThreshold=1000000，程序运行后输出如清单 10 所示。</p>
<h5 id="清单_10-_修改运行参数后清单_8_输出">清单 10. 修改运行参数后清单 8 输出</h5><pre><code>Heap
 def new generation total 6144K, used 354K [<span class="number">0x35c10000</span>, <span class="number">0x362b00</span>00, <span class="number">0x362b00</span>00)
 eden space 5504K, 6% used [<span class="number">0x35c10000</span>, <span class="number">0x35c689</span>d8, <span class="number">0x36170000</span>)
 from space 640K, 0% used [<span class="number">0x36170000</span>, <span class="number">0x36170000</span>, <span class="number">0x36210000</span>)
 to space 640K, 0% used [<span class="number">0x36210000</span>, <span class="number">0x36210000</span>, <span class="number">0x362b00</span>00)
 tenured generation total 13696K, used 1024K [<span class="number">0x362b00</span>00, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 the space 13696K, 7% used [<span class="number">0x362b00</span>00, <span class="number">0x363b00</span>10, <span class="number">0x363b02</span>00, <span class="number">0x37010000</span>)
 compacting perm gen total 12288K, used 374K [<span class="number">0x37010000</span>, <span class="number">0x37c10000</span>, <span class="number">0x3b01000</span>0)
 the space 12288K, 3% used [<span class="number">0x37010000</span>, 0x3706dac8, 0x3706dc00, <span class="number">0x37c10000</span>)
 ro space 10240K, 51% used [<span class="number">0x3b01000</span>0, <span class="number">0x3b54300</span>0, <span class="number">0x3b54300</span>0, 0x3ba10000)
 rw space 12288K, 55% used [0x3ba10000, 0x3c0ae4f8, 0x3c0ae600, <span class="number">0x3c61000</span>0)
</code></pre><p>清单 10 里面可以看到当满 1MB 时进入到了年老代。</p>
<hr>
<h2 id="如何设置对象进入年老代的年龄">如何设置对象进入年老代的年龄</h2><p>堆中的每一个对象都有自己的年龄。一般情况下，年轻对象存放在年轻代，年老对象存放在年老代。为了做到这点，虚拟机为每个对象都维护一个年龄。如果对象在 Eden 区，经过一次 GC 后依然存活，则被移动到 Survivor 区中，对象年龄加 1。以后，如果对象每经过一次 GC 依然存活，则年龄再加 1。当对象年龄达到阈值时，就移入年老代，成为老年对象。这个阈值的最大值可以通过参数-XX:MaxTenuringThreshold 来设置，默认值是 15。虽然-XX:MaxTenuringThreshold 的值可能是 15 或者更大，但这不意味着新对象非要达到这个年龄才能进入年老代。事实上，对象实际进入年老代的年龄是虚拟机在运行时根据内存使用情况动态计算的，这个参数指定的是阈值年龄的最大值。即，实际晋升年老代年龄等于动态计算所得的年龄与-XX:MaxTenuringThreshold 中较小的那个。清单 11 所示代码为 3 个对象申请了若干内存。</p>
<h5 id="清单_11-_申请内存">清单 11. 申请内存</h5><pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MaxTenuringThreshold</span> {
 <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String args[]</span>)</span>{
 <span class="keyword">byte</span>[] b1,b2,b3;
 b1 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">512</span>];
 b2 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">2</span>];
 b3 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">4</span>];
 b3 = <span class="keyword">null</span>;
 b3 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">4</span>];
 }
}
</code></pre><p>参数设置为：-XX:+PrintGCDetails -Xmx20M -Xms20M -Xmn10M -XX:SurvivorRatio=2</p>
<p>运行清单 11 所示代码，输出如清单 12 所示。</p>
<h5 id="清单_12-_清单_11_运行输出">清单 12. 清单 11 运行输出</h5><pre><code>[GC [DefNew: 2986K-&gt;690K(7680K), <span class="number">0.0246816</span> secs] 2986K-&gt;2738K(17920K),
 <span class="number">0.0247226</span> secs] [Times: user=0.00 sys=0.02, real=0.03 secs] 
[GC [DefNew: 4786K-&gt;690K(7680K), <span class="number">0.0016073</span> secs] 6834K-&gt;2738K(17920K), 
<span class="number">0.0016436</span> secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
Heap
 def new generation total 7680K, used 4888K [<span class="number">0x35c10000</span>, <span class="number">0x36610000</span>, <span class="number">0x36610000</span>)
 eden space 5120K, 82% used [<span class="number">0x35c10000</span>, <span class="number">0x36029a18</span>, <span class="number">0x36110000</span>)
 from space 2560K, 26% used [<span class="number">0x36110000</span>, 0x361bc950, <span class="number">0x36390000</span>)
 to space 2560K, 0% used [<span class="number">0x36390000</span>, <span class="number">0x36390000</span>, <span class="number">0x36610000</span>)
 tenured generation total 10240K, used 2048K [<span class="number">0x36610000</span>, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 the space 10240K, 20% used [<span class="number">0x36610000</span>, <span class="number">0x36810010</span>, <span class="number">0x36810200</span>, <span class="number">0x37010000</span>)
 compacting perm gen total 12288K, used 374K [<span class="number">0x37010000</span>, <span class="number">0x37c10000</span>, <span class="number">0x3b01000</span>0)
 the space 12288K, 3% used [<span class="number">0x37010000</span>, 0x3706db50, 0x3706dc00, <span class="number">0x37c10000</span>)
 ro space 10240K, 51% used [<span class="number">0x3b01000</span>0, <span class="number">0x3b54300</span>0, <span class="number">0x3b54300</span>0, 0x3ba10000)
 rw space 12288K, 55% used [0x3ba10000, 0x3c0ae4f8, 0x3c0ae600, <span class="number">0x3c61000</span>0)
</code></pre><p>更改参数为-XX:+PrintGCDetails -Xmx20M -Xms20M -Xmn10M -XX:SurvivorRatio=2<br> -XX:MaxTenuringThreshold=1，运行清单 11 所示代码，输出如清单 13 所示。</p>
<h5 id="清单_13-_修改运行参数后清单_11_输出">清单 13. 修改运行参数后清单 11 输出</h5><pre><code>[GC [DefNew: 2986K-&gt;690K(7680K), <span class="number">0.0047778</span> secs] 2986K-&gt;2738K(17920K),
 <span class="number">0.0048161</span> secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
[GC [DefNew: 4888K-&gt;0K(7680K), <span class="number">0.0016271</span> secs] 6936K-&gt;2738K(17920K),
<span class="number">0.0016630</span> secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
Heap
 def new generation total 7680K, used 4198K [<span class="number">0x35c10000</span>, <span class="number">0x36610000</span>, <span class="number">0x36610000</span>)
 eden space 5120K, 82% used [<span class="number">0x35c10000</span>, <span class="number">0x36029a18</span>, <span class="number">0x36110000</span>)
 from space 2560K, 0% used [<span class="number">0x36110000</span>, <span class="number">0x36110088</span>, <span class="number">0x36390000</span>)
 to space 2560K, 0% used [<span class="number">0x36390000</span>, <span class="number">0x36390000</span>, <span class="number">0x36610000</span>)
 tenured generation total 10240K, used 2738K [<span class="number">0x36610000</span>, <span class="number">0x37010000</span>, <span class="number">0x37010000</span>)
 the space 10240K, 26% used [<span class="number">0x36610000</span>, 0x368bc890, 0x368bca00, <span class="number">0x37010000</span>)
 compacting perm gen total 12288K, used 374K [<span class="number">0x37010000</span>, <span class="number">0x37c10000</span>, <span class="number">0x3b01000</span>0)
 the space 12288K, 3% used [<span class="number">0x37010000</span>, 0x3706db50, 0x3706dc00, <span class="number">0x37c10000</span>)
 ro space 10240K, 51% used [<span class="number">0x3b01000</span>0, <span class="number">0x3b54300</span>0, <span class="number">0x3b54300</span>0, 0x3ba10000)
 rw space 12288K, 55% used [0x3ba10000, 0x3c0ae4f8, 0x3c0ae600, <span class="number">0x3c61000</span>0)
</code></pre><p>清单 13 所示，第一次运行时 b1 对象在程序结束后依然保存在年轻代。第二次运行前，我们减小了对象晋升年老代的年龄，设置为 1。即，所有经过一次 GC 的对象都可以直接进入年老代。程序运行后，可以发现 b1 对象已经被分配到年老代。如果希望对象尽可能长时间地停留在年轻代，可以设置一个较大的阈值。</p>
<hr>
<h2 id="稳定的_Java_堆_VS_动荡的_Java_堆">稳定的 Java 堆 VS 动荡的 Java 堆</h2><p>一般来说，稳定的堆大小对垃圾回收是有利的。获得一个稳定的堆大小的方法是使-Xms 和-Xmx 的大小一致，即最大堆和最小堆 (初始堆) 一样。如果这样设置，系统在运行时堆大小理论上是恒定的，稳定的堆空间可以减少 GC 的次数。因此，很多服务端应用都会将最大堆和最小堆设置为相同的数值。但是，一个不稳定的堆并非毫无用处。稳定的堆大小虽然可以减少 GC 次数，但同时也增加了每次 GC 的时间。让堆大小在一个区间中震荡，在系统不需要使用大内存时，压缩堆空间，使 GC 应对一个较小的堆，可以加快单次 GC 的速度。基于这样的考虑，JVM 还提供了两个参数用于压缩和扩展堆空间。</p>
<p>-XX:MinHeapFreeRatio 参数用来设置堆空间最小空闲比例，默认值是 40。当堆空间的空闲内存小于这个数值时，JVM 便会扩展堆空间。</p>
<p>-XX:MaxHeapFreeRatio 参数用来设置堆空间最大空闲比例，默认值是 70。当堆空间的空闲内存大于这个数值时，便会压缩堆空间，得到一个较小的堆。</p>
<p>当-Xmx 和-Xms 相等时，-XX:MinHeapFreeRatio 和-XX:MaxHeapFreeRatio 两个参数无效。</p>
<h5 id="清单_14-_堆大小设置">清单 14. 堆大小设置</h5><pre><code><span class="keyword">import</span> java.util.Vector;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSize</span> </span>{
 <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> InterruptedException</span>{
 Vector v = <span class="keyword">new</span> Vector();
 <span class="keyword">while</span>(<span class="keyword">true</span>){
 <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];
 v.add(b);
 <span class="keyword">if</span>(v.size() == <span class="number">10</span>){
 v = <span class="keyword">new</span> Vector();
 }
 Thread.sleep(<span class="number">1</span>);
 }
 }
}
</code></pre><p>清单 14 所示代码是测试-XX:MinHeapFreeRatio 和-XX:MaxHeapFreeRatio 的作用，设置运行参数为-XX:+PrintGCDetails<br> -Xms10M -Xmx40M -XX:MinHeapFreeRatio=40 -XX:MaxHeapFreeRatio=50 时，输出如清单 15 所示。</p>
<h5 id="清单_15-_修改运行参数后清单_14_输出">清单 15. 修改运行参数后清单 14 输出</h5><pre><code>[GC [DefNew: <span class="number">2418</span>K-&gt;<span class="number">178</span>K(<span class="number">3072</span>K), <span class="number">0.0034827</span> secs] <span class="number">2418</span>K-&gt;<span class="number">2226</span>K(<span class="number">9920</span>K),
 <span class="number">0.0035249</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[GC [DefNew: <span class="number">2312</span>K-&gt;<span class="number">0</span>K(<span class="number">3072</span>K), <span class="number">0.0028263</span> secs] <span class="number">4360</span>K-&gt;<span class="number">4274</span>K(<span class="number">9920</span>K), 
<span class="number">0.0029905</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[GC [DefNew: <span class="number">2068</span>K-&gt;<span class="number">0</span>K(<span class="number">3072</span>K), <span class="number">0.0024363</span> secs] <span class="number">6342</span>K-&gt;<span class="number">6322</span>K(<span class="number">9920</span>K),
<span class="number">0.0024836</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[GC [DefNew: <span class="number">2061</span>K-&gt;<span class="number">0</span>K(<span class="number">3072</span>K), <span class="number">0.0017376</span> secs][Tenured: <span class="number">8370</span>K-&gt;<span class="number">8370</span>K(<span class="number">8904</span>K),
<span class="number">0.1392692</span> secs] <span class="number">8384</span>K-&gt;<span class="number">8370</span>K(<span class="number">11976</span>K), [Perm : <span class="number">374</span>K-&gt;<span class="number">374</span>K(<span class="number">12288</span>K)],
<span class="number">0.1411363</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.02</span>, real=<span class="number">0.16</span> secs] 
[GC [DefNew: <span class="number">5138</span>K-&gt;<span class="number">0</span>K(<span class="number">6336</span>K), <span class="number">0.0038237</span> secs] <span class="number">13508</span>K-&gt;<span class="number">13490</span>K(<span class="number">20288</span>K),
<span class="number">0.0038632</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs]
</code></pre><p>改用参数：-XX:+PrintGCDetails -Xms40M -Xmx40M -XX:MinHeapFreeRatio=40<br> -XX:MaxHeapFreeRatio=50，运行输出如清单 16 所示。</p>
<h5 id="清单_16-">清单 16.</h5><p> 再次修改运行参数后清单 14 输出</p>
<pre><code>[GC [DefNew: <span class="number">10678</span>K-&gt;<span class="number">178</span>K(<span class="number">12288</span>K), <span class="number">0.0019448</span> secs] <span class="number">10678</span>K-&gt;<span class="number">178</span>K(<span class="number">39616</span>K), 
 <span class="number">0.0019851</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.03</span> secs] 
[GC [DefNew: <span class="number">10751</span>K-&gt;<span class="number">178</span>K(<span class="number">12288</span>K), <span class="number">0.0010295</span> secs] <span class="number">10751</span>K-&gt;<span class="number">178</span>K(<span class="number">39616</span>K),
<span class="number">0.0010697</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] 
[GC [DefNew: <span class="number">10493</span>K-&gt;<span class="number">178</span>K(<span class="number">12288</span>K), <span class="number">0.0008301</span> secs] <span class="number">10493</span>K-&gt;<span class="number">178</span>K(<span class="number">39616</span>K),
<span class="number">0.0008672</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] 
[GC [DefNew: <span class="number">10467</span>K-&gt;<span class="number">178</span>K(<span class="number">12288</span>K), <span class="number">0.0008522</span> secs] <span class="number">10467</span>K-&gt;<span class="number">178</span>K(<span class="number">39616</span>K),
<span class="number">0.0008905</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] 
[GC [DefNew: <span class="number">10450</span>K-&gt;<span class="number">178</span>K(<span class="number">12288</span>K), <span class="number">0.0008964</span> secs] <span class="number">10450</span>K-&gt;<span class="number">178</span>K(<span class="number">39616</span>K),
<span class="number">0.0009339</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] 
[GC [DefNew: <span class="number">10439</span>K-&gt;<span class="number">178</span>K(<span class="number">12288</span>K), <span class="number">0.0009876</span> secs] <span class="number">10439</span>K-&gt;<span class="number">178</span>K(<span class="number">39616</span>K),
<span class="number">0.0010279</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs]
</code></pre><p>从清单 16 可以看出，此时堆空间的垃圾回收稳定在一个固定的范围。在一个稳定的堆中，堆空间大小始终不变，每次 GC 时，都要应对一个 40MB 的空间。因此，虽然 GC 次数减小了，但是单次 GC 速度不如一个震荡的堆。</p>
<hr>
<h2 id="增大吞吐量提升系统性能">增大吞吐量提升系统性能</h2><p>吞吐量优先的方案将会尽可能减少系统执行垃圾回收的总时间，故可以考虑关注系统吞吐量的并行回收收集器。在拥有高性能的计算机上，进行吞吐量优先优化，可以使用参数：</p>
<pre><code>java –<span class="constant">Xmx3800m</span> –<span class="constant">Xms3800m</span> –<span class="constant">Xmn2G</span> –<span class="constant">Xss128k</span> –<span class="constant">XX</span><span class="symbol">:+UseParallelGC</span> 
   –<span class="constant">XX</span><span class="symbol">:ParallelGC-Threads=</span><span class="number">20</span> –<span class="constant">XX</span><span class="symbol">:+UseParallelOldGC</span>
</code></pre><p>–Xmx380m<br> –Xms3800m：设置 Java 堆的最大值和初始值。一般情况下，为了避免堆内存的频繁震荡，导致系统性能下降，我们的做法是设置最大堆等于最小堆。假设这里把最小堆减少为最大堆的一半，即 1900m，那么 JVM 会尽可能在 1900MB 堆空间中运行，如果这样，发生 GC 的可能性就会比较高；</p>
<p>-Xss128k：减少线程栈的大小，这样可以使剩余的系统内存支持更多的线程；</p>
<p>-Xmn2g：设置年轻代区域大小为 2GB；</p>
<p>–XX:+UseParallelGC：年轻代使用并行垃圾回收收集器。这是一个关注吞吐量的收集器，可以尽可能地减少 GC 时间。</p>
<p>–XX:ParallelGC-Threads：设置用于垃圾回收的线程数，通常情况下，可以设置和 CPU 数量相等。但在 CPU 数量比较多的情况下，设置相对较小的数值也是合理的；</p>
<p>–XX:+UseParallelOldGC：设置年老代使用并行回收收集器。</p>
<div class="ibm-alternate-rule">

<hr>
<h2 id="尝试使用大的内存分页">尝试使用大的内存分页</h2><p>CPU 是通过寻址来访问内存的。32 位 CPU 的寻址宽度是 0~0xFFFFFFFF<br>，计算后得到的大小是 4G，也就是说可支持的物理内存最大是 4G。但在实践过程中，碰到了这样的问题，程序需要使用 4G 内存，而可用物理内存小于 4G，导致程序不得不降低内存占用。为了解决此类问题，现代 CPU 引入了<br> MMU（Memory Management Unit 内存管理单元）。MMU 的核心思想是利用虚拟地址替代物理地址，即 CPU 寻址时使用虚址，由 MMU<br> 负责将虚址映射为物理地址。MMU 的引入，解决了对物理内存的限制，对程序来说，就像自己在使用 4G 内存一样。内存分页 (Paging) 是在使用 MMU 的基础上，提出的一种内存管理机制。它将虚拟地址和物理地址按固定大小（4K）分割成页 (page) 和页帧 (page<br> frame)，并保证页与页帧的大小相同。这种机制，从数据结构上，保证了访问内存的高效，并使 OS 能支持非连续性的内存分配。在程序内存不够用时，还可以将不常用的物理内存页转移到其他存储设备上，比如磁盘，这就是大家耳熟能详的虚拟内存。</p>
<p>在 Solaris 系统中，JVM 可以支持 Large Page<br> Size 的使用。使用大的内存分页可以增强 CPU 的内存寻址能力，从而提升系统的性能。</p>
<pre><code>java –<span class="constant">Xmx2506m</span> –<span class="constant">Xms2506m</span> –<span class="constant">Xmn1536m</span> –<span class="constant">Xss128k</span> –<span class="constant">XX</span><span class="symbol">:++UseParallelGC</span>
 –<span class="constant">XX</span><span class="symbol">:ParallelGCThreads=</span><span class="number">20</span> –<span class="constant">XX</span><span class="symbol">:+UseParallelOldGC</span> –<span class="constant">XX</span><span class="symbol">:+LargePageSizeInBytes=</span><span class="number">256</span>m
</code></pre><p>–XX:+LargePageSizeInBytes：设置大页的大小。</p>
<p>过大的内存分页会导致 JVM 在计算 Heap 内部分区（perm, new,<br> old）内存占用比例时，会出现超出正常值的划分，最坏情况下某个区会多占用一个页的大小。</p>
<hr>
<h2 id="使用非占有的垃圾回收器">使用非占有的垃圾回收器</h2><p>为降低应用软件的垃圾回收时的停顿，首先考虑的是使用关注系统停顿的 CMS 回收器，其次，为了减少 Full GC 次数，应尽可能将对象预留在年轻代，因为年轻代 Minor<br> GC 的成本远远小于年老代的 Full GC。</p>
<pre><code>java –<span class="constant">Xmx3550m</span> –<span class="constant">Xms3550m</span> –<span class="constant">Xmn2g</span> –<span class="constant">Xss128k</span> –<span class="constant">XX</span><span class="symbol">:ParallelGCThreads=</span><span class="number">20</span>
 –<span class="constant">XX</span><span class="symbol">:+UseConcMarkSweepGC</span> –<span class="constant">XX</span><span class="symbol">:+UseParNewGC</span> –<span class="constant">XX</span><span class="symbol">:+SurvivorRatio=</span><span class="number">8</span> –<span class="constant">XX</span><span class="symbol">:TargetSurvivorRatio=</span><span class="number">90</span>
 –<span class="constant">XX</span><span class="symbol">:MaxTenuringThreshold=</span><span class="number">31</span>
</code></pre><p>–XX:ParallelGCThreads=20：设置 20 个线程进行垃圾回收；</p>
<p>–XX:+UseParNewGC：年轻代使用并行回收器；</p>
<p>–XX:+UseConcMarkSweepGC：年老代使用 CMS 收集器降低停顿；</p>
<p>–XX:+SurvivorRatio：设置 Eden 区和 Survivor 区的比例为 8:1。稍大的 Survivor 空间可以提高在年轻代回收生命周期较短的对象的可能性，如果 Survivor 不够大，一些短命的对象可能直接进入年老代，这对系统来说是不利的。</p>
<p>–XX:TargetSurvivorRatio=90：设置 Survivor 区的可使用率。这里设置为 90%，则允许 90%的 Survivor 空间被使用。默认值是 50%。故该设置提高了 Survivor 区的使用率。当存放的对象超过这个百分比，则对象会向年老代压缩。因此，这个选项更有助于将对象留在年轻代。</p>
<p>–XX:MaxTenuringThreshold：设置年轻对象晋升到年老代的年龄。默认值是 15 次，即对象经过 15 次 Minor<br> GC 依然存活，则进入年老代。这里设置为 31，目的是让对象尽可能地保存在年轻代区域。</p>
<hr>
<h2 id="结束语">结束语</h2><p>通过本文的学习，读者了解了如何将新对象预留在年轻代、如何让大对象进入年老代、如何设置对象进入年老代的年龄、稳定的 Java 堆 VS 动荡的 Java 堆、增大吞吐量提升系统性能、尝试使用大的内存分页、使用非占有的垃圾回收器等主题，通过实例及对应输出解释的形式让读者对于 JVM 优化有一个初步认识。如其他文章相同的观点，没有哪一条优化是固定不变的，读者需要自己判断、实践后才能找到正确的道路。</p>
<p>Reference:<a href="http://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/java/j-lo-jvm-optimize-experience/index.html</a></p>
</div>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Study-Notes/">Study Notes</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Java/">Java</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2015/07/02/JVM 优化经验总结/" data-title="JVM 优化经验总结 | Zzzz" data-tsina="2692340043" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/07/20/jvm/" title="jvm结构与机制">
  <strong>上一篇：</strong><br/>
  <span>
  jvm结构与机制</span>
</a>
</div>


<div class="next">
<a href="/2015/07/01/JVM 垃圾回收器工作原理及使用实例介绍/"  title="JVM 垃圾回收器工作原理及使用实例介绍">
 <strong>下一篇：</strong><br/> 
 <span>JVM 垃圾回收器工作原理及使用实例介绍
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
    <!-- ��˵���ۿ� start -->
    <div class="ds-thread" data-thread-key="2015/07/02/JVM 优化经验总结/" data-title="JVM 优化经验总结" data-url="http://yoursite.com/2015/07/02/JVM 优化经验总结/"></div>
    <!-- ��˵���ۿ� end -->
    <!-- ��˵����JS���� start (һ����ҳֻ������һ��) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
      <!-- ��˵����JS���� end -->
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Design-Pattern/" title="Design Pattern">Design Pattern<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Study-Notes/" title="Study Notes">Study Notes<sup>15</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Tcp-Ip/" title="Tcp/Ip">Tcp/Ip<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/springmvc/" title="springmvc">springmvc<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/singleton/" title="singleton">singleton<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/proxy/" title="proxy">proxy<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/HashMap/" title="HashMap">HashMap<sup>1</sup></a></li>
			
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p>  不乱于心，不困于情！ <br/>
			不畏将来，不念过往！</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2692340043" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/SurperSniper" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:surpersniper1992@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="lmg">lmg</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"SuperSniper"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fnull' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
